<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="content-type">
    <title>woodentrack demo</title>
    <script src="http://d3js.org/d3.v2.js"></script>
    <script src="woodentrack.js"></script>
    <script language="javascript">   
      // convert the track plan into a track object
      function parseTrack(plan) {
        var track = new Track();
        var section = track.createSection();
        section.transform = new Transform(300,200,0);
        tokens = plan.match(/\d*(R|L|S|J(R|L)(B|C)|X(R|L)(B|C|D))/g);
        for (i=0; i<tokens.length; i++) {
          var num=parseInt(tokens[i])||1;
          token=tokens[i].match(/(R|L|S|J(R|L)(B|C)|X(R|L)(B|C|D))/g)[0];
          for (j=0;j<num;j++) {
            if (token=="S") section.pieces.push(new Straight(section,2/3));
            else if (token=="R") section.pieces.push(new Bend(1));
            else if (token=="L") section.pieces.push(new Bend(-1));
            else if (token.charAt(0)=="J") {
              var side = token.charAt(1);
              var exit = token.charAt(2);
              section.pieces.push(new Junction((side=="R")?1:-1, exit));
            } else if (token.charAt(0)=="X") {
              var side = token.charAt(1);
              var exit = token.charAt(2);
              section.pieces.push(new Crossover((side=="R")?1:-1, exit));
            }
          }
        }
        return track;
      };

      function drawTrack(plan) {
        var track = parseTrack(plan);
        if (track!=null) {
          // clear existing track
          d3.select("svg").selectAll("path").remove();
          d3.select("svg").selectAll("g").remove();
          // draw new track
          track.draw(d3.select("svg"));
        };
      };
    </script>
  </head>
  <body onLoad="javascript:drawTrack(document.forms[0].code.value);">
    <form name="sketch" id="sketch" action="#">
      <textarea id="code" name="code">S R L</textarea>
      <a href="javascript:drawTrack(document.forms[0].code.value);">draw</a>
    </form>
    <svg width="1000" height="1000"/>
  </body>
</html>
